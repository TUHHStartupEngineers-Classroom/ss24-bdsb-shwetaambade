---
title: "Tidyverse"
author: "Shweta Ambade"
editor: 
  markdown: 
    wrap: 72
---

# Load necessary libraries
library(dplyr)
library(ggplot2)
library(tidyr)
library(stringr)

# Read data from Excel files
bikes <- read_excel("C:/Users/Shweta/Documents/GitHub/ss24-bdsb-shwetaambade/datascience/ds_data/ds_data/01_bike_sales/01_raw_data/bikes.xlsx")
bikeshops <- read_excel("C:/Users/Shweta/Documents/GitHub/ss24-bdsb-shwetaambade/datascience/ds_data/ds_data/01_bike_sales/01_raw_data/bikeshops.xlsx")
orderlines <- read_excel("C:/Users/Shweta/Documents/GitHub/ss24-bdsb-shwetaambade/datascience/ds_data/ds_data/01_bike_sales/01_raw_data/orderlines.xlsx")

# Merge dataframes 
bike_orderlines_joined <- orderlines %>%
  left_join(bikes, by = c("product.id" = "bike.id")) %>%
  left_join(bikeshops, by = c("customer.id" = "bikeshop.id"))

# Extract state abbreviation from location
bike_orderlines_wrangled <- bike_orderlines_joined %>%
  separate(location, into = c("city", "state"), sep = ",") %>%
  mutate(state = str_trim(state))

# Calculating total price
bike_orderlines_wrangled <- bike_orderlines_wrangled %>%
  mutate(total_price = price * quantity)

# Group by state and summarize sales
sales_by_state_tbl <- bike_orderlines_wrangled %>%
  group_by(state, city) %>%
  summarise(total_sales = sum(total_price)) %>%
  arrange(desc(total_sales)) # Arrange states by total sales, descending order

# Visualize sales by state
sales_by_state_tbl %>%
  ggplot(aes(x = reorder(state, -total_sales), y = total_sales)) +
  geom_bar(stat = "identity", fill = "#2DC6D6") +
  labs(
    title = "Revenue by State",
    x = "State",
    y = "Revenue"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) # Rotate x-axis labels


